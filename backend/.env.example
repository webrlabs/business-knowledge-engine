# =============================================================================
# Business Knowledge Engine - Backend Environment Configuration
# =============================================================================
# Copy this file to .env and fill in the values for your environment.
# All URLs should NOT include trailing slashes.
# =============================================================================

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------
NODE_ENV=development
PORT=8080
LOG_LEVEL=info
API_DEFAULT_VERSION=1
API_SUPPORTED_VERSIONS=1

# -----------------------------------------------------------------------------
# Azure AD / Entra ID Authentication (REQUIRED)
# -----------------------------------------------------------------------------
# Tenant ID from Azure AD (Directory ID)
AZURE_AD_TENANT_ID=your-tenant-id

# Application (Client) ID for the backend API
AZURE_AD_CLIENT_ID=your-backend-client-id

# API Audience (usually the Application ID URI)
# Format: api://your-backend-client-id
AZURE_AD_AUDIENCE=api://your-backend-client-id

# Client Secret (OPTIONAL - required for On-Behalf-Of flow and client credentials)
# Only needed if calling downstream APIs on behalf of users
# AZURE_AD_CLIENT_SECRET=your-client-secret

# -----------------------------------------------------------------------------
# Azure AI Foundry / OpenAI Service (REQUIRED)
# Auth: Uses DefaultAzureCredential (Entra ID) - no API key needed
# -----------------------------------------------------------------------------
# AI Foundry endpoint URL (without trailing slash)
AZURE_OPENAI_ENDPOINT=https://your-aiservices.openai.azure.com

# Deployment name for chat completions (e.g., gpt-5.2, gpt-4o)
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-5.2

# Deployment name for embeddings (e.g., text-embedding-ada-002)
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-ada-002

# API version for OpenAI
AZURE_OPENAI_API_VERSION=2024-02-15-preview

# -----------------------------------------------------------------------------
# Azure Document Intelligence (Form Recognizer) (REQUIRED)
# Auth: Uses DefaultAzureCredential (Entra ID) - no API key needed
# -----------------------------------------------------------------------------
AZURE_FORM_RECOGNIZER_ENDPOINT=https://your-docint.cognitiveservices.azure.com

# -----------------------------------------------------------------------------
# Azure AI Search (REQUIRED)
# Auth: Uses DefaultAzureCredential (Entra ID) - no API key needed
# -----------------------------------------------------------------------------
AZURE_SEARCH_ENDPOINT=https://your-search.search.windows.net
AZURE_SEARCH_INDEX_NAME=documents

# -----------------------------------------------------------------------------
# Azure Cosmos DB - SQL API (REQUIRED)
# Auth: Uses DefaultAzureCredential (Entra ID) for data plane operations
# -----------------------------------------------------------------------------
COSMOS_DB_ENDPOINT=https://your-cosmos.documents.azure.com:443

# Database and container names
COSMOS_DB_DATABASE=knowledge-platform
COSMOS_DB_DOCUMENTS_CONTAINER=documents
COSMOS_DB_AUDIT_CONTAINER=audit-logs

# Optional: Use connection string instead of Entra ID
# COSMOS_DB_KEY=your-cosmos-primary-key

# -----------------------------------------------------------------------------
# Azure Cosmos DB - Gremlin API for Knowledge Graph (REQUIRED)
# Auth: Uses DefaultAzureCredential (Entra ID)
# -----------------------------------------------------------------------------
# WebSocket endpoint for Gremlin
COSMOS_GREMLIN_ENDPOINT=wss://your-gremlin.gremlin.cosmos.azure.com:443/

# Database and graph names
COSMOS_GREMLIN_DATABASE=knowledge-graph
COSMOS_GREMLIN_GRAPH=entities

# -----------------------------------------------------------------------------
# Azure Blob Storage (REQUIRED)
# Auth: Uses DefaultAzureCredential (Entra ID) - no connection string needed
# -----------------------------------------------------------------------------
# Storage account name (required for Entra ID auth)
AZURE_STORAGE_ACCOUNT_NAME=yourstorageaccount

# Container for uploaded documents
AZURE_STORAGE_CONTAINER_DOCUMENTS=documents

# Optional: Use connection string instead of Entra ID
# AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=...

# -----------------------------------------------------------------------------
# Azure Key Vault (OPTIONAL - for secret management)
# Auth: Uses DefaultAzureCredential (Entra ID)
# -----------------------------------------------------------------------------
KEYVAULT_URI=https://your-keyvault.vault.azure.net/

# -----------------------------------------------------------------------------
# Rate Limiting (OPTIONAL - defaults shown)
# -----------------------------------------------------------------------------
# RATE_LIMIT_WINDOW_MS=900000
# RATE_LIMIT_MAX_REQUESTS=100

# -----------------------------------------------------------------------------
# OpenAI Rate Limiting (OPTIONAL - for token bucket)
# -----------------------------------------------------------------------------
OPENAI_RPM_LIMIT=60
OPENAI_TPM_LIMIT=90000

# -----------------------------------------------------------------------------
# Feature Toggles (OPTIONAL - for enabling/disabling features)
# -----------------------------------------------------------------------------
# PII Redaction - automatically redacts personal information from responses
# Set to 'false' to disable (enabled by default)
# ENABLE_PII_REDACTION=true

# Security Trimming - filters results based on user roles and classification
# Configured via security-trimming-service options (enabled by default)

# Telemetry - Application Insights integration
# Automatically enabled when APPINSIGHTS_INSTRUMENTATIONKEY is set

# -----------------------------------------------------------------------------
# Azure Data Lake Storage Gen2 Connector (OPTIONAL - F4.2.3)
# Auth: Uses DefaultAzureCredential (Entra ID) by default
# -----------------------------------------------------------------------------
# Storage account name (required for ADLS connector)
# ADLS_ACCOUNT_NAME=yourstorageaccount

# File system (container) name to sync from
# ADLS_FILE_SYSTEM_NAME=documents

# Authentication type (default_credential, storage_key, sas_token, connection_string)
# ADLS_AUTHENTICATION_TYPE=default_credential

# Optional: Storage account key (if using storage_key auth)
# ADLS_STORAGE_KEY=your-storage-key

# Optional: SAS token (if using sas_token auth)
# ADLS_SAS_TOKEN=?sv=2021-06-08&ss=...

# Base path to sync from (empty for root)
# ADLS_BASE_PATH=

# Whether to include subdirectories (default: true)
# ADLS_INCLUDE_SUBDIRECTORIES=true

# Comma-separated file extensions to include (empty for all)
# ADLS_FILE_EXTENSIONS=.pdf,.docx,.xlsx,.txt

# Comma-separated paths to exclude (supports wildcards)
# ADLS_EXCLUDE_PATHS=temp/*,archive/*

# Batch size for listing documents (default: 50)
# ADLS_BATCH_SIZE=50

# Maximum file size in bytes (default: 50MB)
# ADLS_MAX_FILE_SIZE_BYTES=52428800

# ACL Sync settings (F4.2.4)
# Enable ACL sync during document ingestion
# ADLS_SYNC_ACLS=true

# Include default ACLs (for directories, inherited by new files)
# ADLS_INCLUDE_DEFAULT_ACLS=true

# Only include entries with read permission in allowedGroups (default: true)
# ADLS_ACL_READ_PERMISSION_REQUIRED=true

# Resolve Azure AD object IDs to display names (requires Graph API access)
# ADLS_RESOLVE_OBJECT_IDS=false

# -----------------------------------------------------------------------------
# SharePoint Connector (F4.2.1)
# Auth: Uses Azure AD app registration with application permissions
# Required Permissions: Sites.Read.All, Files.Read.All (Application permissions)
# -----------------------------------------------------------------------------
# Azure AD tenant ID (or use AZURE_AD_TENANT_ID)
# SHAREPOINT_TENANT_ID=your-tenant-id

# Application (Client) ID for SharePoint connector
# SHAREPOINT_CLIENT_ID=your-sharepoint-client-id

# Client secret for authentication (or use SHAREPOINT_CERTIFICATE_PATH)
# SHAREPOINT_CLIENT_SECRET=your-client-secret

# Path to certificate for certificate-based authentication (optional)
# SHAREPOINT_CERTIFICATE_PATH=/path/to/certificate.pem

# SharePoint site URL (without https:// prefix)
# SHAREPOINT_SITE_URL=contoso.sharepoint.com

# Site path (optional, e.g., /sites/TeamSite)
# SHAREPOINT_SITE_PATH=/sites/YourSite

# Performance settings
# SHAREPOINT_PAGE_SIZE=200
# SHAREPOINT_TIMEOUT_MS=30000
